import{defineComponent as e,ref as t,computed as r,watch as s,onUnmounted as a,createElementBlock as o,openBlock as i,Fragment as n,renderList as l,normalizeClass as u,createBlock as d,resolveDynamicComponent as c}from"vue";import{u as p,d as v,e as f,p as m}from"./shared-DhwEXnCI.js";import{t as h,p as g,m as b,r as w,a as _,s as M,c as j,_ as S}from"./index-P3q3_Kri.js";import{useRoute as V,useRouter as x}from"vue-router";import"./unocss-DYVHIrEJ.js";import"@vuebro/loader-sfc";const E=["id","role"];const P=S(e({__name:"PageView",setup(e,{expose:o}){o();const i=t([]),n=V(),l=x(),u=r(()=>h.value?.siblings??[]),d=[],c=r(()=>u.value.filter(({enabled:e})=>e)),S=()=>{d.forEach(e=>{e()}),d.length=0},E=r(()=>void 0===h.value||h.value.parent?.flat?c.value:[h.value]),P=r(()=>new Map(E.value.map(({id:e=p()})=>[e,!1]))),$=t(new Map(P.value)),k=r(()=>{const[[e,t]=[]]=g;return g.clear(),e&&t&&g.set(e,t),Object.fromEntries(E.value.map(e=>[e.id,b(e)]))});s(i,e=>{S(),setTimeout(()=>{e.forEach(e=>{const{stop:t}=v(e,([{isIntersecting:e,target:{id:t}={}}={}]=[])=>{$.value=new Map(P.value),t&&void 0!==e&&P.value.set(t,e)},{threshold:.1});d.push(t)})})},{deep:!0}),f(window,{behavior:"smooth",onStop:()=>{if(!_.value){const{scrollX:e,scrollY:t}=window,[r]=E.value,[s]=m.value;if(s&&r){const{$children:[{id:a}={}]=[]}=s,o=Math.floor(e)||Math.floor(t)||r.id!==a?[...P.value.entries()].find(([,e])=>e)?.[0]??[...$.value.entries()].find(([,e])=>e)?.[0]??r.id:s.id;o!==n.name&&(M.value=!1,l.push({name:o}).catch(j.error))}}}}),a(S);const y={refs:i,route:n,router:l,siblings:u,stops:d,$siblings:c,clearStops:S,these:E,intersecting:P,$intersecting:$,templates:k,get uid(){return p},get resolve(){return w},get that(){return h}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),[["render",function(e,t,r,s,a,p){return i(!0),o(n,null,l(s.these,e=>(i(),o("div",{id:e.id??s.uid(),key:e.id??s.uid(),ref_for:!0,ref:"refs",class:u(e.class),role:e.id===s.that?.id?"main":"section","un-cloak":""},[(i(),d(c(s.templates[e.id]),{pid:e.id,onVnodeMounted:t=>s.resolve(e)},null,8,["pid","onVnodeMounted"]))],10,E))),128)}],["__file","PageView.vue"]]);export{P as default};
